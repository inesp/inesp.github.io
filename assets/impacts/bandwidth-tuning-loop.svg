<svg viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg" font-family="system-ui, -apple-system, sans-serif">
  <!-- Background -->
  <rect width="500" height="400" fill="#fff"/>

  <!-- Title -->
  <text x="250" y="25" text-anchor="middle" font-size="12" fill="#212529" font-weight="bold">Bandwidth Tuning Loop</text>

  <!-- Step 1: Calculate bandwidth -->
  <rect x="150" y="45" width="200" height="40" rx="4" fill="none" stroke="#212529" stroke-width="1"/>
  <text x="250" y="62" text-anchor="middle" font-size="9" fill="#212529">Calculate bandwidth</text>
  <text x="250" y="76" text-anchor="middle" font-size="8" fill="#6c757d">(Silverman's rule)</text>

  <!-- Arrow down -->
  <line x1="250" y1="85" x2="250" y2="105" stroke="#212529" stroke-width="1"/>
  <polygon points="250,110 245,102 255,102" fill="#212529"/>

  <!-- Step 2: Build KDE -->
  <rect x="130" y="115" width="240" height="40" rx="4" fill="none" stroke="#212529" stroke-width="1"/>
  <text x="250" y="132" text-anchor="middle" font-size="9" fill="#212529">Build KDE, find peaks,</text>
  <text x="250" y="146" text-anchor="middle" font-size="9" fill="#212529">classify as SOUND or OUTLIER</text>

  <!-- Arrow down -->
  <line x1="250" y1="155" x2="250" y2="175" stroke="#212529" stroke-width="1"/>
  <polygon points="250,180 245,172 255,172" fill="#212529"/>

  <!-- Decision 1: Too many outliers? -->
  <polygon points="250,185 350,220 250,255 150,220" fill="#fff" stroke="#212529" stroke-width="1"/>
  <text x="250" y="215" text-anchor="middle" font-size="8" fill="#212529">Most peaks are</text>
  <text x="250" y="227" text-anchor="middle" font-size="8" fill="#212529">OUTLIER?</text>

  <!-- YES branch (left) -->
  <line x1="150" y1="220" x2="80" y2="220" stroke="#212529" stroke-width="1"/>
  <line x1="80" y1="220" x2="80" y2="280" stroke="#212529" stroke-width="1"/>
  <polygon points="80,285 75,277 85,277" fill="#212529"/>
  <text x="110" y="212" font-size="8" fill="#22a522" font-weight="bold">YES</text>

  <!-- Multiply by 5 box -->
  <rect x="30" y="290" width="100" height="45" rx="4" fill="#ffed50" stroke="#212529" stroke-width="1"/>
  <text x="80" y="308" text-anchor="middle" font-size="9" fill="#212529" font-weight="bold">bandwidth × 5</text>
  <text x="80" y="318" text-anchor="middle" font-size="8" fill="#6c757d">(smooth more,</text>
  <text x="80" y="328" text-anchor="middle" font-size="8" fill="#6c757d">find fewer peaks)</text>

  <!-- Arrow from ×5 back up -->
  <line x1="30" y1="312" x2="15" y2="312" stroke="#212529" stroke-width="1"/>
  <line x1="15" y1="312" x2="15" y2="135" stroke="#212529" stroke-width="1"/>
  <line x1="15" y1="135" x2="125" y2="135" stroke="#212529" stroke-width="1"/>
  <polygon points="130,135 122,130 122,140" fill="#212529"/>

  <!-- NO branch (down) - goes to second decision -->
  <line x1="250" y1="255" x2="250" y2="275" stroke="#212529" stroke-width="1"/>
  <polygon points="250,280 245,272 255,272" fill="#212529"/>
  <text x="260" y="268" font-size="8" fill="#fd456f" font-weight="bold">NO</text>

  <!-- Decision 2: Still noisy? -->
  <polygon points="250,285 340,315 250,345 160,315" fill="#fff" stroke="#212529" stroke-width="1"/>
  <text x="250" y="312" text-anchor="middle" font-size="8" fill="#212529">Still noisy after</text>
  <text x="250" y="324" text-anchor="middle" font-size="8" fill="#212529">removing outliers?</text>

  <!-- YES branch (right) - divide by 3 -->
  <line x1="340" y1="315" x2="400" y2="315" stroke="#212529" stroke-width="1"/>
  <line x1="400" y1="315" x2="400" y2="280" stroke="#212529" stroke-width="1"/>
  <polygon points="400,275 395,283 405,283" fill="#212529"/>
  <text x="375" y="307" font-size="8" fill="#22a522" font-weight="bold">YES</text>

  <!-- Divide by 3 box -->
  <rect x="350" y="225" width="100" height="45" rx="4" fill="#ffed50" stroke="#212529" stroke-width="1"/>
  <text x="400" y="243" text-anchor="middle" font-size="9" fill="#212529" font-weight="bold">bandwidth ÷ 3</text>
  <text x="400" y="252" text-anchor="middle" font-size="8" fill="#6c757d">(smooth less,</text>
  <text x="400" y="262" text-anchor="middle" font-size="8" fill="#6c757d">find more detail)</text>

  <!-- Arrow from ÷3 back up -->
  <line x1="450" y1="247" x2="485" y2="247" stroke="#212529" stroke-width="1"/>
  <line x1="485" y1="247" x2="485" y2="135" stroke="#212529" stroke-width="1"/>
  <line x1="485" y1="135" x2="375" y2="135" stroke="#212529" stroke-width="1"/>
  <polygon points="370,135 378,130 378,140" fill="#212529"/>

  <!-- NO branch (down) - Done! -->
  <line x1="250" y1="345" x2="250" y2="360" stroke="#212529" stroke-width="1"/>
  <polygon points="250,365 245,357 255,357" fill="#212529"/>
  <text x="260" y="358" font-size="8" fill="#fd456f" font-weight="bold">NO</text>

  <!-- Done box -->
  <rect x="200" y="368" width="100" height="30" rx="15" fill="#22a522" stroke="#212529" stroke-width="1"/>
  <text x="250" y="388" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Done!</text>
</svg>
